–û—Ç–ª–∏—á–Ω–æ! üéØ  
–°–µ–π—á–∞—Å —è –ø–æ–¥–≥–æ—Ç–æ–≤–ª—é —Ç–µ–±–µ **–¥–æ–∫—É–º–µ–Ω—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–µ Markdown**, –∫–æ—Ç–æ—Ä—ã–π —Ç—ã —Å–º–æ–∂–µ—à—å –ª–µ–≥–∫–æ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ Obsidian –∏–ª–∏ –ª—é–±–æ–º –¥—Ä—É–≥–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–µ–º Markdown.

---

# üìö `mapPartitionsWithIndex()` –≤ PySpark: –ø–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

## üîç –ß—Ç–æ —ç—Ç–æ?

–ú–µ—Ç–æ–¥ `mapPartitionsWithIndex()` ‚Äî —ç—Ç–æ –º–æ—â–Ω–∞—è —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –≤ Spark, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–∑–≤–æ–ª—è–µ—Ç:
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ –ø–∞—Ä—Ç–∏—Ü–∏—è–º
- –ü–æ–ª—É—á–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ **–Ω–æ–º–µ—Ä—É –ø–∞—Ä—Ç–∏—Ü–∏–∏**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∏–Ω–¥–µ–∫—Å –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è, —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏, –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### ‚úÖ –ü–æ–¥–ø–∏—Å—å –º–µ—Ç–æ–¥–∞:

```python
rdd.mapPartitionsWithIndex(f: (index: int, iterator: Iterator[T]) -> Iterator[U])
```

---

## üîÑ –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```python
rdd = sc.parallelize([10, 20, 30, 40, 50], numSlices=3)
```

‚û°Ô∏è –ü—Ä–µ–¥–ø–æ–ª–æ–∂–∏–º, —É –Ω–∞—Å 3 –ø–∞—Ä—Ç–∏—Ü–∏–∏:

| –ü–∞—Ä—Ç–∏—Ü–∏—è | –°–æ–¥–µ—Ä–∂–∏—Ç —ç–ª–µ–º–µ–Ω—Ç—ã |
|----------|--------------------|
| 0        | [10, 20]          |
| 1        | [30, 40]          |
| 2        | [50]               |

---

## üß† –û—Å–Ω–æ–≤–Ω—ã–µ –∫–µ–π—Å—ã –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è

### 1. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –ø–∞—Ä—Ç–∏—Ü–∏–π**

```python
def log_partition(index, items):
    print(f"–ü–∞—Ä—Ç–∏—Ü–∏—è {index}:")
    for item in items:
        print(" ‚Üí", item)
    return items  # –º–æ–∂–Ω–æ —Ç–∞–∫–∂–µ yield from items

rdd.mapPartitionsWithIndex(log_partition).count()
```

> ‚ö†Ô∏è –í—ã–≤–æ–¥ –±—É–¥–µ—Ç –≤ –ª–æ–≥–∞—Ö Executor'–∞, –∞ –Ω–µ –Ω–∞ –¥—Ä–∞–π–≤–µ—Ä–µ, –µ—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞–µ—à—å –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ!

---

### 2. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ ID –ø–∞—Ä—Ç–∏—Ü–∏–∏ –∫ –∫–∞–∂–¥–æ–º—É —ç–ª–µ–º–µ–Ω—Ç—É**

```python
def add_index(index, items):
    for item in items:
        yield (index, item)

indexed_rdd = rdd.mapPartitionsWithIndex(add_index)
print(indexed_rdd.collect())
```

### ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç:
```
[(0, 10), (0, 20), (1, 30), (1, 40), (2, 50)]
```

---

### 3. **–ö–∞—Å—Ç–æ–º–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ –Ω–æ–º–µ—Ä—É –ø–∞—Ä—Ç–∏—Ü–∏–∏**

```python
def custom_process(index, items):
    if index % 2 == 0:
        for x in items:
            yield x * 2
    else:
        for x in items:
            yield x * 10

processed = rdd.mapPartitionsWithIndex(custom_process)
print(processed.collect())
```

### ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç:
```
[20, 40, 300, 400, 100]
```

---

### 4. **–ü–æ–¥—Å—á—ë—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ –ø–∞—Ä—Ç–∏—Ü–∏—è–º**

```python
def stats(index, items):
    count = 0
    total = 0
    for x in items:
        count += 1
        total += x
    yield (index, count, total)

stats_rdd = rdd.mapPartitionsWithIndex(stats)
print(stats_rdd.collect())
```

### ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç:
```
[(0, 2, 30), (1, 2, 70), (2, 1, 50)]
```

---

## ‚öôÔ∏è –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–¥ –∫–∞–ø–æ—Ç–æ–º?

1. –ö–∞–∂–¥–∞—è –ø–∞—Ä—Ç–∏—Ü–∏—è ‚Äî —ç—Ç–æ **–∏—Ç–µ—Ä–∞—Ç–æ—Ä** –Ω–∞–¥ –¥–∞–Ω–Ω—ã–º–∏.
2. –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ –∫–∞–∂–¥–æ–π –ø–∞—Ä—Ç–∏—Ü–∏–∏ –æ—Ç–¥–µ–ª—å–Ω–æ.
3. –ú–æ–∂–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –¥–∞–Ω–Ω—ã–µ —Å —É—á—ë—Ç–æ–º –∏—Ö —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è.
4. –†–µ–∑—É–ª—å—Ç–∞—Ç ‚Äî –Ω–æ–≤—ã–π RDD, –≥–¥–µ –∫–∞–∂–¥—ã–π —ç–ª–µ–º–µ–Ω—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –∏–∑–º–µ–Ω—ë–Ω —Å —É—á—ë—Ç–æ–º –∏–Ω–¥–µ–∫—Å–∞.

---

## üìò mapPartitions() vs mapPartitionsWithIndex()

| –ú–µ—Ç–æ–¥ | –ò–Ω–¥–µ–∫—Å –ø–∞—Ä—Ç–∏—Ü–∏–∏? | –ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –∏—Ç–µ—Ä–∞—Ç–æ—Ä–æ–º? | –õ—É—á—à–µ —ç–∫–æ–Ω–æ–º–∏—Ç –ø–∞–º—è—Ç—å? |
|-------|------------------|-------------------------------|-------------------------|
| `mapPartitions()` | ‚ùå –ù–µ—Ç | ‚úÖ –î–∞ | ‚úÖ –î–∞ |
| `mapPartitionsWithIndex()` | ‚úÖ –î–∞ | ‚úÖ –î–∞ | ‚úÖ –î–∞ |

---

## üéØ –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å?

| –¶–µ–ª—å | –ò—Å–ø–æ–ª—å–∑—É–π `mapPartitionsWithIndex()` |
|------|------------------------------------|
| –û—Ç–ª–∞–¥–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ –ø–∞—Ä—Ç–∏—Ü–∏—è–º | ‚úÖ –û—á–µ–Ω—å –ø–æ–ª–µ–∑–µ–Ω |
| –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –æ –ø–∞—Ä—Ç–∏—Ü–∏–∏ | ‚úÖ –î–∞ |
| –†–∞–∑–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–æ–º–µ—Ä–∞ –ø–∞—Ä—Ç–∏—Ü–∏–∏ | ‚úÖ –î–∞ |
| –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö | ‚úÖ –î–∞ |
| –†–∞–±–æ—Ç–∞ —Å —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –≤–Ω—É—Ç—Ä–∏ –ø–∞—Ä—Ç–∏—Ü–∏–∏ | ‚úÖ –î–∞ |

---

## üß™ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ

–°–æ–∑–¥–∞–π —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è:
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç –∏–Ω–¥–µ–∫—Å –∏ –∏—Ç–µ—Ä–∞—Ç–æ—Ä
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ç–µ —ç–ª–µ–º–µ–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ø–∞–ª–∏ –≤ —á—ë—Ç–Ω—É—é –ø–∞—Ä—Ç–∏—Ü–∏—é

```python
def even_partitions_only(index, items):
    if index % 2 == 0:
        for item in items:
            yield item
    else:
        return iter([])  # –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –ø—É—Å—Ç–æ–π –∏—Ç–µ—Ä–∞—Ç–æ—Ä

even_rdd = rdd.mapPartitionsWithIndex(even_partitions_only)
print(even_rdd.collect())  # => [10, 20, 50]
```

---

## üìù –°–æ–≤–µ—Ç—ã –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

| –ß—Ç–æ —Ö–æ—á–µ—à—å —Å–¥–µ–ª–∞—Ç—å | –ö–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å |
|--------------------|------------------|
| –£–∑–Ω–∞—Ç—å, –∫–∞–∫ –¥–∞–Ω–Ω—ã–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –ø–æ –ø–∞—Ä—Ç–∏—Ü–∏—è–º | ‚úÖ `mapPartitionsWithIndex` + –≤—ã–≤–æ–¥ –≤ –∫–æ–Ω—Å–æ–ª—å |
| –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–µ–∫—Å –ø–∞—Ä—Ç–∏—Ü–∏–∏ –∫ –¥–∞–Ω–Ω—ã–º | ‚úÖ `(index, item)` |
| –í—ã–ø–æ–ª–Ω–∏—Ç—å —Ä–∞–∑–Ω—É—é –ª–æ–≥–∏–∫—É –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∏–Ω–¥–µ–∫—Å–∞ | ‚úÖ `if index == ...` |
| –ù–µ –ø–æ—Ç–µ—Ä—è—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –∏—Ç–µ—Ä–∞—Ç–æ—Ä–∞ | ‚úÖ `yield from items` –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ `for x in items: yield x` |
| –ò–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–æ–∫ —Ç–∏–ø–∞ "–Ω–µ –∏—Ç–µ—Ä–∏—Ä—É–µ–º—ã–π –æ–±—ä–µ–∫—Ç" | ‚úÖ –í—Å–µ–≥–¥–∞ –≤–æ–∑–≤—Ä–∞—â–∞–π –∏—Ç–µ—Ä–∞—Ç–æ—Ä (`yield`, `return list`, `return generator`) |

---

## üéØ –ò—Ç–æ–≥:

| –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—å | –ï—Å—Ç—å –ª–∏? |
|-------------|-----------|
| –î–æ—Å—Ç—É–ø –∫ –∏–Ω–¥–µ–∫—Å—É –ø–∞—Ä—Ç–∏—Ü–∏–∏ | ‚úÖ –î–∞ |
| –õ–µ–Ω–∏–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö | ‚úÖ –î–∞ |
| –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –±–æ–ª—å—à–∏—Ö –ø–∞—Ä—Ç–∏—Ü–∏–π | ‚úÖ –î–∞ |
| –ú–æ–∂–µ—Ç –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ | ‚úÖ –î–∞ |
| –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç yield / –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã | ‚úÖ –î–∞ |

---
