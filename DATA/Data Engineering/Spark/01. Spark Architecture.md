# Deployment modes

В Apache Spark существует несколько режимов развертывания (deployment modes), которые определяют, как и где будет выполняться драйвер (driver) программы. Эти режимы влияют на архитектуру выполнения задачи и могут быть выбраны в зависимости от требований к производительности, масштабируемости и удобства разработки. Рассмотрим три основных режима: **local**, **client** и **cluster**.

---

### 1. **Local Mode**
#### Описание:
- В этом режиме Spark запускается локально на одной машине.
- Все компоненты Spark (драйвер, исполнители и т.д.) работают в рамках одного процесса JVM.
- Этот режим используется для тестирования и разработки, так как он не требует настройки кластера или дополнительных ресурсов.

#### Характеристики:
- **Драйвер:** Запускается в том же процессе, что и приложение.
- **Исполнители (executors):** Также работают локально.
- **Масштабируемость:** Не подходит для больших объемов данных, так как ограничена ресурсами одной машины.
- **Пример использования:** Отладка кода, прототипирование.

#### Как запустить:
```bash
spark-submit --master local[*] your_app.py
```
Здесь `local[*]` означает использование всех доступных ядер процессора на локальной машине.

---

### 2. **Client Mode**
#### Описание:
- В этом режиме драйвер запускается на машине, с которой была отправлена задача (например, на компьютере разработчика).
- Исполнители (executors) запускаются на рабочих узлах кластера, управляемых менеджером ресурсов (например, YARN, Mesos или Kubernetes).

#### Характеристики:
- **Драйвер:** Запускается локально на машине пользователя.
- **Исполнители:** Распределены по кластеру.
- **Отладка:** Удобен для мониторинга логов и отладки, так как драйвер работает на локальной машине.
- **Ограничения:** Если машина пользователя выключается или теряет связь с кластером, задача может завершиться с ошибкой.

#### Как запустить:
```bash
spark-submit --master yarn --deploy-mode client your_app.py
```

#### Пример использования:
- Разработка и отладка приложений в кластере.
- Сценарии, где требуется быстрый запуск и контроль над выполнением задачи.

---

### 3. **Cluster Mode**
#### Описание:
- В этом режиме драйвер запускается внутри кластера, обычно на одном из рабочих узлов.
- Это позволяет полностью абстрагироваться от машины пользователя и делает выполнение задачи независимым от локального окружения.

#### Характеристики:
- **Драйвер:** Запускается на одном из рабочих узлов кластера.
- **Исполнители:** Также распределены по кластеру.
- **Надежность:** Даже если машина пользователя выключается, задача продолжит выполняться.
- **Мониторинг:** Логи драйвера недоступны напрямую на машине пользователя, их нужно проверять через интерфейс кластера (например, YARN UI).

#### Как запустить:
```bash
spark-submit --master yarn --deploy-mode cluster your_app.py
```

#### Пример использования:
- Производственные среды, где важна отказоустойчивость.
- Сценарии, где пользовательская машина не должна участвовать в выполнении задачи.

---

### Сравнение режимов

| Характеристика         | Local Mode                     | Client Mode                    | Cluster Mode                   |
|------------------------|--------------------------------|--------------------------------|--------------------------------|
| **Место запуска драйвера** | Локальная машина             | Локальная машина              | На одном из рабочих узлов      |
| **Место запуска исполнителей** | Локальная машина            | Кластер                       | Кластер                        |
| **Масштабируемость**    | Низкая                        | Высокая                       | Высокая                        |
| **Отладка**             | Удобно                        | Удобно                        | Сложнее (логи в кластере)      |
| **Рекомендации**        | Тестирование, разработка      | Отладка в кластере            | Производственные среды         |

---

### Дополнительные замечания:
1. **Менеджеры ресурсов:**
   - Spark поддерживает различные менеджеры ресурсов, такие как YARN, Mesos и Kubernetes. Выбор режима (client или cluster) зависит от конфигурации этих менеджеров.
   
2. **Локальный кластер:**
   - Для тестирования можно запустить "локальный кластер" с использованием `local-cluster[N, cores, memory]`, где `N` — количество исполнителей, `cores` — количество ядер, а `memory` — объем памяти для каждого исполнителя.

3. **Производительность:**
   - В production-средах рекомендуется использовать **cluster mode**, так как он обеспечивает лучшую отказоустойчивость и масштабируемость.
