Семейство движков `Log` в ClickHouse — это группа простых движков, предназначенных для хранения данных без сложной обработки, дедубликации или агрегации, как в семействе `MergeTree`. Они оптимизированы для сценариев, где важна скорость записи и минимальная сложность, но не требуется высокая производительность при чтении или сложная обработка данных. Давайте разберем это семейство подробно: сколько движков входит, для чего они предназначены, и приведем примеры кода.

---

### Общее описание семейства Log

- **Основная идея**:
  - Движки семейства `Log` хранят данные в виде лога, то есть строки добавляются последовательно, без слияния, индексации или дедубликации.
  - Они не поддерживают фоновое слияние (merge), как `MergeTree`, и не имеют первичных или вторичных индексов.
  - Данные хранятся в простом формате, что делает запись очень быстрой, но чтение может быть медленным, особенно для больших таблиц.

- **Особенности**:
  - Нет поддержки операций `ALTER` (например, нельзя добавить или удалить столбец после создания таблицы).
  - Нет поддержки индексов (ни первичных, ни вторичных).
  - Нет слияния частей (parts), как в `MergeTree`.
  - Данные хранятся в виде отдельных файлов для каждого столбца.

- **Общие кейсы использования**:
  - Хранение логов, временных данных или промежуточных результатов.
  - Сценарии, где важна скорость записи, а чтение происходит редко или с помощью полного сканирования.
  - Отладка или тестирование, когда не требуется сложная обработка.

---

### Движки семейства Log

Семейство `Log` состоит из трёх движков:
1. `Log`
2. `TinyLog`
3. `StripeLog`

#### 1. Log
- **Назначение**:
  - Базовый движок семейства `Log`, предназначен для хранения данных в виде лога без сжатия.
  - Подходит для сценариев, где нужно просто записывать данные без сложной обработки.
- **Особенности**:
  - Каждый столбец хранится в отдельном файле (например, `column1.bin`, `column2.bin`).
  - Дополнительно создаётся файл метаданных `sizes.json`, который содержит информацию о размерах файлов столбцов.
  - Не использует сжатие данных, поэтому может занимать больше места на диске по сравнению с другими движками.
  - Очень прост в реализации, но неэффективен для больших объёмов данных из-за отсутствия индексов и сжатия.
- **Кейсы использования**:
  - Хранение логов приложения или событий для последующего анализа.
  - Временное хранение данных перед переносом в другую систему или таблицу (например, с движком `MergeTree`).
  - Тестирование или отладка, когда не нужны сложные функции.
- **Пример кода**:
  ```sql
  -- Создание таблицы с движком Log
  CREATE TABLE log_table (
      event_id UInt32,
      event_time DateTime,
      message String
  )
  ENGINE = Log;

  -- Вставка данных
  INSERT INTO log_table (event_id, event_time, message)
  VALUES
      (1, '2025-05-24 01:49:00', 'User logged in'),
      (2, '2025-05-24 01:50:00', 'User logged out');

  -- Чтение данных
  SELECT * FROM log_table;
  ```
  **Результат**:
  ```
  ┌─────────┬─────────────────────┬────────────────┐
  │ event_id│ event_time          │ message        │
  ├─────────┼─────────────────────┼────────────────┤
  │ 1       │ 2025-05-24 01:49:00 │ User logged in │
  │ 2       │ 2025-05-24 01:50:00 │ User logged out│
  └─────────┴─────────────────────┴────────────────┘
  ```
  - Данные просто добавляются в конец лога, без сжатия или индексации.

#### 2. TinyLog
- **Назначение**:
  - Упрощённая версия `Log`, оптимизированная для таблиц с небольшим количеством строк и столбцов.
  - Подходит для хранения очень маленьких таблиц, где важна минимальная накладная стоимость.
- **Особенности**:
  - Как и `Log`, хранит каждый столбец в отдельном файле (например, `column1.bin`).
  - Не создаёт файл метаданных `sizes.json`, что уменьшает накладные расходы.
  - Ещё проще, чем `Log`, но менее эффективен для больших данных.
  - Не поддерживает сжатие и индексы.
- **Кейсы использования**:
  - Хранение небольших логов или метрик (например, несколько тысяч записей).
  - Временные таблицы для промежуточных вычислений.
  - Сценарии, где нужно минимизировать накладные расходы на метаданные.
- **Пример кода**:
  ```sql
  -- Создание таблицы с движком TinyLog
  CREATE TABLE tiny_log_table (
      sensor_id UInt16,
      temperature Float32,
      timestamp DateTime
  )
  ENGINE = TinyLog;

  -- Вставка данных
  INSERT INTO tiny_log_table (sensor_id, temperature, timestamp)
  VALUES
      (1, 23.5, '2025-05-24 01:49:00'),
      (2, 24.0, '2025-05-24 01:50:00');

  -- Чтение данных
  SELECT * FROM tiny_log_table;
  ```
  **Результат**:
  ```
  ┌──────────┬────────────┬─────────────────────┐
  │ sensor_id│ temperature│ timestamp           │
  ├──────────┼────────────┼─────────────────────┤
  │ 1        │ 23.5       │ 2025-05-24 01:49:00 │
  │ 2        │ 24.0       │ 2025-05-24 01:50:00 │
  └──────────┴────────────┴─────────────────────┘
  ```
  - Данные записываются последовательно, без файла `sizes.json`.

#### 3. StripeLog
- **Назначение**:
  - Более продвинутая версия `Log`, оптимизированная для хранения данных с использованием чередования (striping).
  - Подходит для сценариев, где нужно хранить больше данных, чем в `TinyLog`, но без сложной обработки.
- **Особенности**:
  - Данные хранятся в двух файлах:
    - Один файл для всех значений столбцов (`data.bin`), где строки чередуются (stripe).
    - Один файл для меток (marks), чтобы быстро находить строки (`marks.mrk`).
  - Поддерживает базовое сжатие данных (в отличие от `Log` и `TinyLog`), что делает его более эффективным по занимаемому месту.
  - Всё ещё не поддерживает индексы и фоновое слияние.
- **Кейсы использования**:
  - Хранение логов или событий, где объём данных больше, чем в `TinyLog`, но не требуется сложная аналитика.
  - Сценарии, где важна экономия места на диске (благодаря сжатию).
- **Пример кода**:
  ```sql
  -- Создание таблицы с движком StripeLog
  CREATE TABLE stripe_log_table (
      user_id UInt32,
      action String,
      event_time DateTime
  )
  ENGINE = StripeLog;

  -- Вставка данных
  INSERT INTO stripe_log_table (user_id, action, event_time)
  VALUES
      (101, 'click', '2025-05-24 01:49:00'),
      (102, 'view', '2025-05-24 01:50:00');

  -- Чтение данных
  SELECT * FROM stripe_log_table;
  ```
  **Результат**:
  ```
  ┌────────┬────────┬─────────────────────┐
  │ user_id│ action │ event_time          │
  ├────────┼────────┼─────────────────────┤
  │ 101    │ click  │ 2025-05-24 01:49:00 │
  │ 102    │ view   │ 2025-05-24 01:50:00 │
  └────────┴────────┴─────────────────────┘
  ```
  - Данные хранятся с чередованием в `data.bin`, сжатие применяется автоматически.

---

### Сравнение движков семейства Log

| Движок       | Хранение данных                  | Метаданные         | Сжатие | Кейсы использования                     | Производительность |
|--------------|----------------------------------|--------------------|--------|-----------------------------------------|--------------------|
| **Log**      | Отдельный файл для столбца      | `sizes.json`       | Нет    | Хранение логов, отладка                | Быстрая запись, медленное чтение |
| **TinyLog**  | Отдельный файл для столбца      | Нет                | Нет    | Маленькие таблицы, временные данные    | Очень быстрая запись, медленное чтение |
| **StripeLog**| Чередование в одном файле       | `marks.mrk`        | Да     | Логи среднего объёма, экономия места   | Быстрая запись, чуть лучше чтение |

---

### Когда использовать семейство Log?

- **Когда использовать**:
  - Для хранения логов, временных данных или промежуточных результатов.
  - Если вам нужна максимальная скорость записи и вы готовы пожертвовать скоростью чтения.
  - Для небольших таблиц или тестовых сценариев.
- **Когда НЕ использовать**:
  - Для аналитики или больших объёмов данных — используйте `MergeTree` (например, `ReplacingMergeTree`, `SummingMergeTree`).
  - Если нужны индексы, дедубликация, сжатие или сложные операции (например, `ALTER`).

---

### Итог

- **Сколько движков в семействе Log?** 3: `Log`, `TinyLog`, `StripeLog`.
- **Для чего предназначены**:
  - `Log`: Базовый лог для простого хранения данных.
  - `TinyLog`: Упрощённый лог для маленьких таблиц.
  - `StripeLog`: Лог с чередованием и сжатием для больших объёмов.
- **Примеры кода** показывают, как просто создать таблицы и записать данные.

Если у вас есть конкретный сценарий, где вы хотите использовать движки `Log`, или вы хотите сравнить их с `MergeTree`, дайте знать! Хотите продолжить с ClickHouse, вернуться к тесту по Apache Spark или обсудить что-то другое?