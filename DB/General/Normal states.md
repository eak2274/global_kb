# Шпаргалка по нормализации и нормальным формам БД

## Что такое нормализация?
- Процесс упрощения структуры базы данных для **уменьшения избыточности данных** и **предотвращения аномалий** (например, при вставке, обновлении, удалении).
- Делится на **нормальные формы** (1NF, 2NF, 3NF, BCNF, 4NF, 5NF), каждая из которых строится на предыдущей.

---

## 1-я нормальная форма (1NF)
### Правила:
1. Все столбцы должны содержать **атомарные (неделимые) значения**.
2. Нет повторяющихся групп или массивов.
3. Каждый столбец имеет уникальный ключ.

### Отрицательный пример 1 (нарушение атомарности):
| ID_заказа | Товары          | Дата       |
|-----------|-----------------|------------|
| 1         | Яблоки, Груши   | 2025-06-10 |

- **Почему нарушено?**: Столбец `Товары` содержит список (неатомарное значение), что затрудняет обновление (например, удаление одного товара).

### Исправленный пример 1:
| ID_заказа | Дата       |
|-----------|------------|
| 1         | 2025-06-10 |

| ID_заказа | Товар  |
|-----------|--------|
| 1         | Яблоки |
| 1         | Груши  |

- **Почему исправлено?**: Каждый `Товар` теперь атомарен.

### Отрицательный пример 2 (повторяющиеся группы):
| ID_заказа | Товар1  | Товар2 | Дата       |
|-----------|---------|--------|------------|
| 1         | Яблоки  | Груши  | 2025-06-10 |

- **Почему нарушено?**: Повторяющиеся группы (`Товар1`, `Товар2`) создают избыточность и усложняют добавление нового товара.

### Исправленный пример 2:
| ID_заказа | Дата       |
|-----------|------------|
| 1         | 2025-06-10 |

| ID_заказа | Товар  |
|-----------|--------|
| 1         | Яблоки |
| 1         | Груши  |

- **Почему исправлено?**: Повторяющиеся группы вынесены в отдельную таблицу.

### Отрицательный пример 3 (отсутствие уникального ключа):
| Товар   | Количество |
|---------|------------|
| Яблоки  | 5          |
| Груши   | 3          |

- **Почему нарушено?**: Нет уникального идентификатора (например, `ID_заказа`), что приводит к дублированию строк.

### Исправленный пример 3:
| ID_заказа | Товар   | Количество |
|-----------|---------|------------|
| 1         | Яблоки  | 5          |
| 2         | Груши   | 3          |

- **Почему исправлено?**: Добавлен `ID_заказа` как уникальный ключ.

---

## 2-я нормальная форма (2NF)
### Правила:
- Должна быть в 1NF.
- Все неключевые атрибуты должны зависеть от **всей составной первичной ключи**, а не от её части.

### Отрицательный пример (зависимость от части ключа):
| ID_заказа | Товар   | Цена_товара | Дата       |
|-----------|---------|-------------|------------|
| 1         | Яблоко  | 10          | 2025-06-10 |
(Первичный ключ: `ID_заказа`, `Товар`)

- **Почему нарушено?**: `Цена_товара` зависит только от `Товар`, а не от всей комбинации (`ID_заказа`, `Товар`), что вызывает избыточность.

### Исправленный пример:
| ID_заказа | Товар   | Дата       |
|-----------|---------|------------|
| 1         | Яблоко  | 2025-06-10 |

| Товар   | Цена_товара |
|---------|-------------|
| Яблоко  | 10          |

- **Почему исправлено?**: `Цена_товара` вынесена и зависит только от `Товар`.

---

## 3-я нормальная форма (3NF)
### Правила:
- Должна быть в 2NF.
- Все неключевые атрибуты должны зависеть только от **первичного ключа**, а не от других неключевых атрибутов (убрать транзитивные зависимости).

### Отрицательный пример (транзитивная зависимость):
| ID_сотр | Имя   | Отдел    | Начальник |
|---------|-------|----------|-----------|
| 1       | Иван  | Продажи  | Петр      |

- **Почему нарушено?**: `Начальник` зависит от `Отдел`, а не напрямую от `ID_сотр`.

### Исправленный пример:
| ID_сотр | Имя   | Отдел    |
|---------|-------|----------|
| 1       | Иван  | Продажи  |

| Отдел    | Начальник |
|----------|-----------|
| Продажи  | Петр      |

- **Почему исправлено?**: `Начальник` вынесен в отдельную таблицу.

---

## Нормальная форма Бойса-Кодда (BCNF)
### Правила:
- Должна быть в 3NF.
- Для каждого функционального зависимости неключевой атрибут должен зависеть только от **полного ключа** (даже если ключ составной).

### Отрицательный пример (зависимость от части ключа):
| Курс       | Преподаватель | Аудитория |
|------------|---------------|-----------|
| Математика | Анна          | 101       |
(Первичный ключ: `Курс`, `Преподаватель`)

- **Почему нарушено?**: `Аудитория` зависит только от `Курс`, а не от всей комбинации (`Курс`, `Преподаватель`).

### Исправленный пример:
| Курс       | Аудитория |
|------------|-----------|
| Математика | 101       |

| Курс       | Преподаватель |
|------------|---------------|
| Математика | Анна          |

- **Почему исправлено?**: `Аудитория` вынесена и зависит только от `Курс`.

---

## 4-я нормальная форма (4NF)
### Правила:
- Должна быть в BCNF.
- Убрать **многозначные зависимости** (когда два неключевых атрибута независимо зависят от ключа).

### Отрицательный пример (многозначная зависимость):
| Студент | Курс       | Хобби  |
|---------|------------|--------|
| Иван    | Математика | Футбол |
| Иван    | Физика     | Футбол |

- **Почему нарушено?**: `Хобби` и `Курс` независимо зависят от `Студент`, создавая избыточность.

### Исправленный пример:
| Студент | Хобби  |
|---------|--------|
| Иван    | Футбол |

| Студент | Курс       |
|---------|------------|
| Иван    | Математика |
| Иван    | Физика     |

- **Почему исправлено?**: Многозначные зависимости разделены.

---

## 5-я нормальная форма (5NF) или Форма Джойн-Проекции
### Правила:
- Должна быть в 4NF.
- Убрать **потерю информации при разложении** (все данные должны восстанавливаться через джойны).

### Отрицательный пример (потеря при разложении):
| Поставщик | Деталь | Проект |
|-----------|--------|--------|
| A         | X      | P1     |
| A         | Y      | P1     |
(Но связь A, X, P2 теряется)

- **Почему нарушено?**: Разделение на подтаблицы может потерять данные (например, связь A-X-P2).

### Исправленный пример:
| Поставщик | Деталь | Проект |
|-----------|--------|--------|
| A         | X      | P1     |
| A         | Y      | P1     |
| A         | X      | P2     |

- **Почему исправлено?**: Все комбинации данных сохранены, и их можно восстановить через джойны.

---

## Полезные советы для собеседований:
- **Почему нормализация важна?**: Снижает дублирование и упрощает обновления.
- **Когда денормализовать?**: Для повышения производительности (например, в аналитических БД), но с осторожностью.
- **Пример вопроса**: "Как ты привёл таблицу к 3NF?" — опиши шаги с примерами выше.
- **Бонус**: Упомяни, что 5NF редко используется из-за сложности, но важно знать теоретически.